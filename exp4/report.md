# Report

程序的输出结果为

```
naive 32 1 Exec-time: 9.62362 ms
shared_memory 32 1 Exec-time: 10.1282 ms
naive 32 2 Exec-time: 7.61371 ms
shared_memory 32 2 Exec-time: 6.54132 ms
naive 32 3 Exec-time: 7.62571 ms
shared_memory 32 3 Exec-time: 5.8263 ms
naive 32 4 Exec-time: 7.64166 ms
shared_memory 32 4 Exec-time: 5.53355 ms
naive 32 5 Exec-time: 7.69883 ms
shared_memory 32 5 Exec-time: 5.80512 ms
naive 32 6 Exec-time: 7.70562 ms
shared_memory 32 6 Exec-time: 5.72926 ms
naive 32 7 Exec-time: 7.68755 ms
shared_memory 32 7 Exec-time: 5.59292 ms
naive 32 8 Exec-time: 7.70216 ms
shared_memory 32 8 Exec-time: 5.49205 ms
naive 32 9 Exec-time: 7.72162 ms
shared_memory 32 9 Exec-time: 5.54208 ms
naive 32 10 Exec-time: 7.75568 ms
shared_memory 32 10 Exec-time: 5.63436 ms
naive 32 11 Exec-time: 7.85114 ms
shared_memory 32 11 Exec-time: 5.98378 ms
naive 32 12 Exec-time: 7.77012 ms
shared_memory 32 12 Exec-time: 5.65208 ms
naive 32 13 Exec-time: 8.01395 ms
shared_memory 32 13 Exec-time: 6.22493 ms
naive 32 14 Exec-time: 7.85547 ms
shared_memory 32 14 Exec-time: 5.8884 ms
naive 32 15 Exec-time: 7.83282 ms
shared_memory 32 15 Exec-time: 5.68768 ms
naive 32 16 Exec-time: 7.78816 ms
shared_memory 32 16 Exec-time: 5.49919 ms
naive 32 17 Exec-time: 8.19762 ms
shared_memory 32 17 Exec-time: 6.34983 ms
naive 32 18 Exec-time: 8.03314 ms
shared_memory 32 18 Exec-time: 6.03185 ms
naive 32 19 Exec-time: 8.02535 ms
shared_memory 32 19 Exec-time: 5.95281 ms
naive 32 20 Exec-time: 7.92996 ms
shared_memory 32 20 Exec-time: 5.76797 ms
naive 32 21 Exec-time: 7.92906 ms
shared_memory 32 21 Exec-time: 5.71551 ms
naive 32 22 Exec-time: 8.4072 ms
shared_memory 32 22 Exec-time: 7.07148 ms
naive 32 23 Exec-time: 8.37373 ms
shared_memory 32 23 Exec-time: 6.81477 ms
naive 32 24 Exec-time: 8.3141 ms
shared_memory 32 24 Exec-time: 6.81284 ms
naive 32 25 Exec-time: 8.32101 ms
shared_memory 32 25 Exec-time: 6.56163 ms
naive 32 26 Exec-time: 8.22628 ms
shared_memory 32 26 Exec-time: 6.48773 ms
naive 32 27 Exec-time: 7.99002 ms
shared_memory 32 27 Exec-time: 6.22805 ms
naive 32 28 Exec-time: 7.99261 ms
shared_memory 32 28 Exec-time: 6.29177 ms
naive 32 29 Exec-time: 7.99766 ms
shared_memory 32 29 Exec-time: 6.00433 ms
naive 32 30 Exec-time: 7.95586 ms
shared_memory 32 30 Exec-time: 6.07404 ms
naive 32 31 Exec-time: 7.9474 ms
shared_memory 32 31 Exec-time: 5.91363 ms
naive 32 32 Exec-time: 7.91284 ms
shared_memory 32 32 Exec-time: 5.99414 ms
naive 64 1 Exec-time: 7.61288 ms
shared_memory 64 1 Exec-time: 6.45522 ms
naive 64 2 Exec-time: 7.63381 ms
shared_memory 64 2 Exec-time: 5.5136 ms
naive 64 3 Exec-time: 7.67922 ms
shared_memory 64 3 Exec-time: 5.56476 ms
naive 64 4 Exec-time: 7.68744 ms
shared_memory 64 4 Exec-time: 5.32109 ms
naive 64 5 Exec-time: 7.74415 ms
shared_memory 64 5 Exec-time: 5.59838 ms
naive 64 6 Exec-time: 7.77163 ms
shared_memory 64 6 Exec-time: 5.61195 ms
naive 64 7 Exec-time: 7.88611 ms
shared_memory 64 7 Exec-time: 5.88716 ms
naive 64 8 Exec-time: 7.81478 ms
shared_memory 64 8 Exec-time: 5.40574 ms
naive 64 9 Exec-time: 8.08048 ms
shared_memory 64 9 Exec-time: 6.0926 ms
naive 64 10 Exec-time: 7.96511 ms
shared_memory 64 10 Exec-time: 5.69867 ms
naive 64 11 Exec-time: 8.50711 ms
shared_memory 64 11 Exec-time: 7.09314 ms
naive 64 12 Exec-time: 8.41474 ms
shared_memory 64 12 Exec-time: 6.72069 ms
naive 64 13 Exec-time: 8.28799 ms
shared_memory 64 13 Exec-time: 6.28349 ms
naive 64 14 Exec-time: 8.02315 ms
shared_memory 64 14 Exec-time: 6.03917 ms
naive 64 15 Exec-time: 8.0063 ms
shared_memory 64 15 Exec-time: 5.88994 ms
naive 64 16 Exec-time: 7.95446 ms
shared_memory 64 16 Exec-time: 5.77322 ms
naive 96 1 Exec-time: 7.61929 ms
shared_memory 96 1 Exec-time: 5.84863 ms
naive 96 2 Exec-time: 7.65462 ms
shared_memory 96 2 Exec-time: 5.48358 ms
naive 96 3 Exec-time: 7.67115 ms
shared_memory 96 3 Exec-time: 5.3179 ms
naive 96 4 Exec-time: 7.73665 ms
shared_memory 96 4 Exec-time: 5.48806 ms
naive 96 5 Exec-time: 7.79538 ms
shared_memory 96 5 Exec-time: 5.56006 ms
naive 96 6 Exec-time: 8.00986 ms
shared_memory 96 6 Exec-time: 5.99546 ms
naive 96 7 Exec-time: 7.88571 ms
shared_memory 96 7 Exec-time: 5.5438 ms
naive 96 8 Exec-time: 8.40606 ms
shared_memory 96 8 Exec-time: 6.64006 ms
naive 96 9 Exec-time: 8.02149 ms
shared_memory 96 9 Exec-time: 6.09034 ms
naive 96 10 Exec-time: 7.99631 ms
shared_memory 96 10 Exec-time: 5.75243 ms
naive 128 1 Exec-time: 7.62787 ms
shared_memory 128 1 Exec-time: 5.61877 ms
naive 128 2 Exec-time: 7.66388 ms
shared_memory 128 2 Exec-time: 5.24304 ms
naive 128 3 Exec-time: 7.74326 ms
shared_memory 128 3 Exec-time: 5.5087 ms
naive 128 4 Exec-time: 7.7651 ms
shared_memory 128 4 Exec-time: 5.29673 ms
naive 128 5 Exec-time: 7.88248 ms
shared_memory 128 5 Exec-time: 5.6021 ms
naive 128 6 Exec-time: 8.30226 ms
shared_memory 128 6 Exec-time: 6.56153 ms
naive 128 7 Exec-time: 7.99845 ms
shared_memory 128 7 Exec-time: 5.92673 ms
naive 128 8 Exec-time: 7.94551 ms
shared_memory 128 8 Exec-time: 5.59814 ms
naive 160 1 Exec-time: 7.64014 ms
shared_memory 160 1 Exec-time: 5.708 ms
naive 160 2 Exec-time: 7.69622 ms
shared_memory 160 2 Exec-time: 5.39983 ms
naive 160 3 Exec-time: 7.77444 ms
shared_memory 160 3 Exec-time: 5.47783 ms
naive 160 4 Exec-time: 7.83892 ms
shared_memory 160 4 Exec-time: 5.5526 ms
naive 160 5 Exec-time: 8.1381 ms
shared_memory 160 5 Exec-time: 6.3876 ms
naive 160 6 Exec-time: 7.92266 ms
shared_memory 160 6 Exec-time: 5.71083 ms
naive 192 1 Exec-time: 7.66043 ms
shared_memory 192 1 Exec-time: 5.66938 ms
naive 192 2 Exec-time: 7.73104 ms
shared_memory 192 2 Exec-time: 5.41408 ms
naive 192 3 Exec-time: 7.94737 ms
shared_memory 192 3 Exec-time: 5.90823 ms
naive 192 4 Exec-time: 8.15747 ms
shared_memory 192 4 Exec-time: 6.51204 ms
naive 192 5 Exec-time: 7.95281 ms
shared_memory 192 5 Exec-time: 5.61479 ms
naive 224 1 Exec-time: 7.64638 ms
shared_memory 224 1 Exec-time: 5.52259 ms
naive 224 2 Exec-time: 7.79472 ms
shared_memory 224 2 Exec-time: 5.65062 ms
naive 224 3 Exec-time: 7.81613 ms
shared_memory 224 3 Exec-time: 5.37585 ms
naive 224 4 Exec-time: 7.91702 ms
shared_memory 224 4 Exec-time: 5.94407 ms
naive 256 1 Exec-time: 7.66543 ms
shared_memory 256 1 Exec-time: 5.46959 ms
naive 256 2 Exec-time: 7.75683 ms
shared_memory 256 2 Exec-time: 5.2604 ms
naive 256 3 Exec-time: 8.10491 ms
shared_memory 256 3 Exec-time: 6.3221 ms
naive 256 4 Exec-time: 7.91726 ms
shared_memory 256 4 Exec-time: 5.34938 ms
naive 288 1 Exec-time: 7.66201 ms
shared_memory 288 1 Exec-time: 5.49165 ms
naive 288 2 Exec-time: 7.92563 ms
shared_memory 288 2 Exec-time: 5.86486 ms
naive 288 3 Exec-time: 7.97385 ms
shared_memory 288 3 Exec-time: 5.89682 ms
naive 320 1 Exec-time: 7.70379 ms
shared_memory 320 1 Exec-time: 5.59629 ms
naive 320 2 Exec-time: 7.86648 ms
shared_memory 320 2 Exec-time: 5.51651 ms
naive 320 3 Exec-time: 7.92813 ms
shared_memory 320 3 Exec-time: 5.42249 ms
naive 352 1 Exec-time: 7.77467 ms
shared_memory 352 1 Exec-time: 5.90576 ms
naive 352 2 Exec-time: 8.10839 ms
shared_memory 352 2 Exec-time: 6.54913 ms
naive 384 1 Exec-time: 7.73213 ms
shared_memory 384 1 Exec-time: 5.63134 ms
naive 384 2 Exec-time: 8.05116 ms
shared_memory 384 2 Exec-time: 6.16799 ms
naive 416 1 Exec-time: 7.87619 ms
shared_memory 416 1 Exec-time: 6.17394 ms
naive 416 2 Exec-time: 8.01393 ms
shared_memory 416 2 Exec-time: 5.91252 ms
naive 448 1 Exec-time: 7.80989 ms
shared_memory 448 1 Exec-time: 5.84687 ms
naive 448 2 Exec-time: 7.90372 ms
shared_memory 448 2 Exec-time: 5.66289 ms
naive 480 1 Exec-time: 7.74852 ms
shared_memory 480 1 Exec-time: 5.64203 ms
naive 480 2 Exec-time: 7.85057 ms
shared_memory 480 2 Exec-time: 5.48186 ms
naive 512 1 Exec-time: 7.73975 ms
shared_memory 512 1 Exec-time: 5.50875 ms
naive 512 2 Exec-time: 7.8691 ms
shared_memory 512 2 Exec-time: 5.22907 ms
naive 544 1 Exec-time: 7.97759 ms
shared_memory 544 1 Exec-time: 6.27997 ms
naive 576 1 Exec-time: 7.92825 ms
shared_memory 576 1 Exec-time: 6.06152 ms
naive 608 1 Exec-time: 7.93401 ms
shared_memory 608 1 Exec-time: 6.01433 ms
naive 640 1 Exec-time: 7.86894 ms
shared_memory 640 1 Exec-time: 5.8268 ms
naive 672 1 Exec-time: 7.82316 ms
shared_memory 672 1 Exec-time: 5.63813 ms
naive 704 1 Exec-time: 8.13276 ms
shared_memory 704 1 Exec-time: 6.82571 ms
naive 736 1 Exec-time: 8.06017 ms
shared_memory 736 1 Exec-time: 6.56031 ms
naive 768 1 Exec-time: 8.06498 ms
shared_memory 768 1 Exec-time: 6.55398 ms
naive 800 1 Exec-time: 7.97553 ms
shared_memory 800 1 Exec-time: 6.36656 ms
naive 832 1 Exec-time: 8.01218 ms
shared_memory 832 1 Exec-time: 6.30089 ms
naive 864 1 Exec-time: 7.95621 ms
shared_memory 864 1 Exec-time: 6.28108 ms
naive 896 1 Exec-time: 7.91633 ms
shared_memory 896 1 Exec-time: 6.05392 ms
naive 928 1 Exec-time: 7.84417 ms
shared_memory 928 1 Exec-time: 5.99132 ms
naive 960 1 Exec-time: 7.91226 ms
shared_memory 960 1 Exec-time: 5.98012 ms
naive 992 1 Exec-time: 7.99551 ms
shared_memory 992 1 Exec-time: 5.97168 ms
naive 1024 1 Exec-time: 7.84355 ms
shared_memory 1024 1 Exec-time: 5.75363 ms
```

> 不同的 thread block size 的选取，对程序性能的影响；

对于naive方法来说，整体看thread block size越大，效率越低
对于shared_memory方法来说，整体看thread block size越大，则程序性能越好

> 如何设置 thread block size 才可以达到最好的效果？为什么？

尽量使block size为 `x*2`，因为可以使计算后的数据共享，并且计算求和并行化，提升效率。同时size大小应为32的倍数，因为每个warp有32个线程

> Shared memory 是否使用，对程序性能的影响；

一般来说，使用shared memory可以提升程序性能

> Shared memory 总是带来优化吗？如果不是，为什么？

并不一定，如该例：

```
naive 32 1 Exec-time: 9.62362 ms
shared_memory 32 1 Exec-time: 10.1282 ms
```

由于块只有一行，因此只有左右两个相邻线程的计算数据可以用来共享，而加入额外的共享内存的效率损失可能超过了共享数据带来的效率提升。

> Shared memory 在什么 thread block size 下有效果，什么时候没有？

在多行多列的thread block size下有效果，若只有一行或一列，那效果就会降低

> 上述两者的相互影响。

两者对于性能的影响是可以同时叠加的。

> 还有哪些可以优化的地方？

可以计算得到每个2*2小方块内的和，会被周围12次计算同时用到。

> 对于任意一个给定程序，应该如何设置 thread block size？

每个维数应当为32的倍数

> 对于任意一个给定程序，应该如何决定 shared memory 的使用？

shared memory的大小不应占SM中共享内存的过多部分，不然会导致共享内存竞争，降低效率
