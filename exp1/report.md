# MPI 异步通信小作业 实验报告 

方科晨 2021013400

## 任务一

InfiniBand:


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        |   1.17     |  4.47     |
| 2    | 2        |   1.12     |   9.02     |
| 3    | 4        |   1.09     |   18.07     |
| 4    | 8        |   1.08     |  36.91     |
| 5    | 16       |   1.08     |  74.12      |
| 6    | 32       |   1.14    |   145.08     |
| 7    | 64       |   1.26     |   266.05     |
| 8    | 128      |   1.33     |  510.82      |
| 9    | 256      |   1.90     |    1054.00    |
| 10   | 512      |   1.97     |   1961.77     |
| 11   | 1024     |   2.24     |   3200.68     |
| 12   | 2048     |   2.71     |   5101.64     |
| 13   | 4096     |   3.67     |   6999.82     |
| 14   | 8192     |   5.26     |   6281.77     |
| 15   | 16384    |   7.20     |    10400.56    |
| 16   | 32768    |   9.86     |   10980.91     |
| 17   | 65536    |   15.39     |  11609.82     |
| 18   | 131072   |   26.65     |   11839.04     |
| 19   | 262144   |   32.08     |   11951.09     |
| 20   | 524288   |   57.47     |    12009.64    |
| 21   | 1048576  |   99.99     |    12042.31    |
| 22   | 2097152  |   187.16     |   12051.28     |
| 23   | 4194304  |   361.40     |   12059.36     |

以太网：


| 编号 | 消息长度 | 延迟 (us) | 带宽(MB/s) |
| ---- | -------- | ------ | ------ |
| 1    | 1        |  44.96     |   0.30     |
| 2    | 2        |   45.18     |   0.60     |
| 3    | 4        |   45.04     |  1.20      |
| 4    | 8        |   45.25     |   2.35     |
| 5    | 16       |   45.33     |   5.08     |
| 6    | 32       |   45.57     |  9.22     |
| 7    | 64       |   46.56     |   16.71     |
| 8    | 128      |   48.14     |   33.43     |
| 9    | 256      |   52.67     |   55.64     |
| 10   | 512      |   58.52     |   80.81     |
| 11   | 1024     |   70.49     |   95.72     |
| 12   | 2048     |   87.91     |   105.16     |
| 13   | 4096     |   109.89     |   110.78     |
| 14   | 8192     |   186.04     |   114.19     |
| 15   | 16384    |   214.58     |   116.05     |
| 16   | 32768    |   359.24     |   116.76     |
| 17   | 65536    |   635.69    |    117.12    |
| 18   | 131072   |   1197.96     |  117.39      |
| 19   | 262144   |   2415.12     |  117.52      |
| 20   | 524288   |   4644.44     |  117.57      |
| 21   | 1048576  |   9090.01    |  117.60      |


- 请描述当消息长度增加时，带宽和延迟分别呈现出什么样的趋势？

    随着消息长度的增加，带宽和延迟都会逐渐上升。随着消息长度的成倍增加，延迟开始时上升地较慢，之后上升也逐渐成倍上升。而带宽则是先和消息长度近似同步成倍增加，之后接近不变

- 该趋势在两种网络下有何不同？

    相较而言，延迟上InfiniBand较低，但是增长速度略快于以太网；带宽上InfiniBand更高，增长速度也越快

- 为什么会有这样的趋势？

    因为消息长度是在成倍增加，刚开始不超过某个阈值时，一次传输时长接近不便，因此带宽随着消息长度成倍增加。之后消息长度超过阈值，不能单次便传输完成，使得传输延迟也随着消息长度成倍增加，两者相抵消使得带宽近乎不变

- 对比InfiniBand和以太网络下的带宽和延迟，它们之间的差距是多少？

    以消息长度1048576为例，InfiniBand的带宽约为以太网络的102倍，延迟只约有以太网络的1/25

## 任务二

| 编号 | 消息长度  | 计算量 | mpi_sync 总耗时 | mpi_async  总耗时 |
| ---- | --------- | ------ | --------------- | ----------------- |
| 1    | 100000000 | 10     | 970.839 ms            | 844.019 ms              |
| 2    | 100000000 | 20     | 1037.9 ms            | 666.629 ms              |
| 3    | 100000000 | 40     | 1376.42 ms            | 1038.93 ms              |
| 4    | 100000000 | 80     | 1681.11 ms            | 841.468 ms              |
| 5    | 100000000 | 160    | 2481.1 ms            | 1600.72 ms              |

- 通信时间和计算时间满足什么关系时，非阻塞通信程序能完美掩盖通信时间？

    当计算时间大于通信时间时，非阻塞通信程序可以完美覆盖通信时间

- 简述两份代码的不同之处。

    `mpi_sync.cpp` 使用的是阻塞通信，0号进程向1号进程发送信息完毕之后才开始计算，而 `mpi_async.cpp` 使用的是非阻塞通信，可以一边传输信息一边进行计算。

